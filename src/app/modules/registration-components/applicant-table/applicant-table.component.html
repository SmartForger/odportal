<div>
    <mat-form-field>
        <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Search...">
    </mat-form-field>

    <mat-form-field>
        <mat-label>Registration Process</mat-label>
        <mat-select [value]="''" (selectionChange)='onProcessChange($event)'>
            <mat-option [value]="''">All</mat-option>
            <mat-option *ngFor='let process of registrationProcesses' [value]='process.docId'>{{ process.title }}</mat-option>
        </mat-select>
    </mat-form-field>

    <button mat-icon-button [disabled]="processId === ''" (click)='openOptions()'>
        <mat-icon>more_vert</mat-icon>
    </button>
</div>

<table mat-table *ngIf='displayTable' class="full-width table mb-4" [dataSource]="rows">

    <ng-container *ngIf='userColumnCount > 0' matColumnDef='user-column-header'>
        <th mat-header-cell *matHeaderCellDef [attr.colspan]='userColumnCount' class='header'>User</th>
    </ng-container>

    <ng-container *ngIf='verificationColumnCount > 0' matColumnDef='verification-column-header'>
        <th mat-header-cell *matHeaderCellDef [attr.colspan]='verificationColumnCount' class='header'>Verification</th>
    </ng-container>

    <ng-container *ngIf='registrationColumnCount > 0' matColumnDef='registration-column-header'>
        <th mat-header-cell *matHeaderCellDef [attr.colspan]='registrationColumnCount' class='header'>Registration</th>
    </ng-container>

    <ng-container *ngFor='let column of columns'>
        <!-- LISTS -->
        <ng-container *ngIf='column.bindingType === 3'>
            <ng-container *ngIf='column.columnGroup === 0' matColumnDef='{{ getColDef(column) }}'>
                <th mat-header-cell *matHeaderCellDef [attr.colspan]='listSubheaders(column).length' class='header'>{{ column.title }}</th>
            </ng-container>
            <ng-container *ngFor='let key of listSubheaders(column)'>
                <ng-container matColumnDef='{{ getSubcolDef(column, key) }}'>
                    <th  #subheader mat-header-cell *matHeaderCellDef [id]="'subheader-' + column.binding" [ngClass]="{'sort-header': sortCol === column.binding && sortKey === key, 'subheader': true}" (click)='sort(column, key)'>
                        <div class='subheader-text-wrapper'>
                            <span [ngClass]="{'sort-text': sortCol === column.binding && sortKey === key, 'subheader-text': true}">{{ key }}</span>
                            <mat-icon *ngIf='showDescArrow(column.binding, key)'>arrow_downward</mat-icon>
                            <mat-icon *ngIf='showAscArrow(column.binding, key)'>arrow_upward</mat-icon>
                        </div>
                    </th>
                    <td mat-cell *matCellDef='let row'>
                        <ng-container *ngTemplateOutlet='cellDef; context:{ column: column, row: row, key: key }'></ng-container>
                    </td>
                </ng-container>
            </ng-container>
        </ng-container>

        <!-- NON-LISTS -->
        <ng-container *ngIf='column.bindingType !== 3'>
            <ng-container *ngIf='column.columnGroup === 0' matColumnDef='{{ column.binding}}'>
                <th mat-header-cell *matHeaderCellDef class='header'>{{ column.title }}</th>
            </ng-container>
            <ng-container matColumnDef='{{ column.binding }}'>
                <th #subheader mat-header-cell *matHeaderCellDef [id]="'subheader-' + column.binding" [ngClass]="{'subheader': true, 'sort-header': sortCol === column.binding}" (click)='sort(column)'>
                    <div [ngClass]="{'sort-text': sortCol === column.binding, 'subheader-text': true}">{{ column.title }}</div>
                    <mat-icon *ngIf='showDescArrow(column.binding)'>arrow_downward</mat-icon>
                    <mat-icon *ngIf='showAscArrow(column.binding)'>arrow_upward</mat-icon>
                    <div matRipple></div>
                </th>
                <td mat-cell *matCellDef='let row'>
                    <ng-container *ngTemplateOutlet='cellDef; context:{ column: column, row: row }'></ng-container>
                </td>
            </ng-container>
        </ng-container>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="headerColumnsDef"></tr>
    <tr mat-header-row *matHeaderRowDef="columnsDef"></tr>
    <tr mat-row *matRowDef="let row; columns: columnsDef"></tr>
</table>

<ng-template #cellDef let-column="column" let-row='row' let-key='key'>
    <!-- TEXT VALUES -->
    <span *ngIf='column.bindingType === 0'>{{ row[column.binding] }}</span>

    <!-- BOOLEAN VALUES -->
    <span *ngIf='column.bindingType === 1'>
        <div class='icon-container'>
            <ng-container *ngIf='column.columnGroup !== 3'>
                <mat-icon *ngIf='row[column.binding]'>check_circle_outline</mat-icon>
                <mat-icon *ngIf='!row[column.binding]'>remove_circle_outline</mat-icon>
            </ng-container>
            <ng-container *ngIf='column.columnGroup === 3'>
                <ng-container *ngIf='row[column.binding] === true' >
                    <mat-icon class='green'>check_circle</mat-icon>
                    <span class='green-bg check-bg'></span>
                </ng-container>
                <ng-container *ngIf='row[column.binding] === false' >
                    <mat-icon class='orange'>error</mat-icon>
                    <span class='orange-bg check-bg'></span>
                </ng-container>
                <ng-container *ngIf='row[column.binding] === null' >
                    <mat-icon class='gray'>remove_circle</mat-icon>
                    <span class='gray-bg check-bg'></span>
                </ng-container>
            </ng-container>
        </div>
    </span>

    <!-- RADIO VALUES -->
    <span *ngIf='column.bindingType === 2'>{{ row[column.binding] }}</span>

    <!-- LIST VALUES -->
    <span *ngIf='column.bindingType === 3'>
        <div *ngIf='row[column.binding][key]' class='icon-container'>
            <mat-icon class='blue'>check_circle_outline</mat-icon>
            <span class='blue-bg check-bg'></span>
        </div>
        <div *ngIf='!row[column.binding][key] && column.columnGroup !== 3' class='icon-container'>
            <mat-icon class='gray'>remove_circle_outline</mat-icon>
            <span class='gray-bg check-bg'></span>
        </div>
    </span>

    <!-- ENUM VALUES -->
    <span *ngIf='column.bindingType === 4'>{{ row[column.binding] }}</span>

    <!-- PROGRESS VALUES -->
    <span *ngIf='column.bindingType === 5'>
        <div class='green'>{{ round(row[column.binding]) }}% Complete</div>
        <mat-progress-bar mode='determinate' [value]='row[column.binding]'></mat-progress-bar>
    </span>

    <!-- ICON VALUES -->
    <div *ngIf='column.bindingType === 6' class='icon-container'>
        <mat-icon class='icon'>{{ row[column.binding] }}</mat-icon>
        <span class='gray-bg check-bg'></span>
    </div>

    <!-- VERIFICATION VALUES -->
    <span *ngIf='column.bindingType === 7'>
        <div>{{ row[column.binding] }}</div>
    </span>
</ng-template>