<div class="table-container">

    <app-listview-toolbar
        createButtonTitle="Create User"
        searchPlaceholder="Search users"
        [disabled]='!allItemsFetched'
        (create)="onAddUserClick()"
        (loadAll)="fetchAll()"
        (refresh)="refresh()"
        (search)="filterUsers($event)"
        [menuOptions]="menuOptions"
        (selectRole)="selectRole($event)"
        (viewModeChange)="viewModeChange($event)"
        [showViewModeToggle]="true"
        selectedRole="Approved"
    ></app-listview-toolbar>
      
    <app-multi-select-toolbar *ngIf="selectedCount > 0">
        <button
            class="mr-1"
            mat-flat-button
            color="primary"
            (click)="deleteSelectedUsers()">Delete</button>
        <button
            class="mr-1"
            mat-flat-button
            color="primary"
            (click)="assignRolesToSelectedUsers()">Assign roles</button>
        <button
            class="mr-1"
            mat-flat-button
            color="primary"
            (click)="approveSelectedUsers()">Approve</button>
    </app-multi-select-toolbar>

    <table mat-table matSort matSortDisableClear class="table" [dataSource]="viewMode === 'card' ? [] : displayItems">

        <ng-container matColumnDef="username">
            <th mat-header-cell mat-sort-header disableClear *matHeaderCellDef>Username</th>
            <td mat-cell *matCellDef="let user">
                <div
                    (click)="selectionSvc.toggleItem(user)"
                    class="cursor-pointer position-relative username-container"
                >
                    <mat-checkbox color="primary" [checked]="true" *ngIf="selectedItems[user.id]; else notSelected"></mat-checkbox>
                    <ng-template #notSelected>
                        <mat-icon class="avatar status-orange float-left" matTooltip="User pending" *ngIf="user.enabled">person</mat-icon>
                    </ng-template>
                    <div class="text-ellipsis" matTooltip="Edit User">{{user.username}}</div>
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="fullname">
            <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Full Name</th>
            <td mat-cell *matCellDef="let user">
                <div class="text-ellipsis">{{user.firstName}} {{user.lastName}}</div>
            </td>
        </ng-container>

        <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Email</th>
            <td mat-cell *matCellDef="let user">
                <div class="text-ellipsis" *ngIf="user.email">{{user.email}}</div>
                <div class="text-ellipsis" *ngIf="!user.email" class="opacity-half">N/A</div>
            </td>
        </ng-container>

        <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="text-right">&nbsp;</th>
            <td mat-cell *matCellDef="let user" class="text-right">
                <button mat-icon-button matTooltip="Approve User" (click)="approve(user)" class="color-green">
                    <mat-icon>check_circle</mat-icon>
                </button>
                <button mat-icon-button matTooltip="Deny User" (click)="deny(user)" class="color-red">
                    <mat-icon>remove_circle</mat-icon>
                </button>
                <button mat-icon-button [routerLink]="['../edit', user.id]" matTooltip="Edit User">
                    <mat-icon>edit</mat-icon>
                </button>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="viewMode === 'card' ? ['fullname'] : displayedColumns"></tr>
        <tr mat-row *matRowDef="let row: columns: displayedColumns"></tr>

    </table>

    <div class="card-view" *ngIf="viewMode === 'card'">
        <app-user-card [user]="user" *ngFor="let user of displayItems"></app-user-card>
    </div>

    <div [ngClass]="{'pagination': true, 'missing-items': !allItemsFetched}">
        <div *ngIf='allItemsFetched'>
            {{items.length}} Total Users
            <span *ngIf='selectedRole'> (Role: {{selectedRole}})</span>
        </div>
        <mat-paginator [length]='paginatorLength()' [pageSizeOptions]="[10, 25, 50, 100]"
            [showFirstLastButtons]='allItemsFetched'></mat-paginator>
        <!-- <span>{{ displayCount() }} </span> -->
    </div>
</div>